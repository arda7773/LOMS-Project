{% extends "base.html" %}

{% block content %}
<section class="card">
    <h2 class="page-title">{{ curriculum.code }} – {{ curriculum.name }}</h2>
    <p><strong>Program:</strong> {{ curriculum.program.code }} – {{ curriculum.program.name }}</p>
    <p>
        <strong>Year:</strong> {{ curriculum.get_year_display }}
        · <strong>Semester:</strong> {{ curriculum.get_semester_display }}
    </p>
    <p>
        <strong>Lecturer:</strong>
        {% if curriculum.lecturer %}
            {{ curriculum.lecturer.get_full_name|default:curriculum.lecturer.username }}
        {% else %}
            -
        {% endif %}
    </p>
</section>

<section class="card">
    <h3 class="section-title">Assessments & My Grades</h3>
    {% if rows %}
        <table>
            <thead>
                <tr>
                    <th>Assessment</th>
                    <th>Type</th>
                    <th>Date</th>
                    <th>Weight (%)</th>
                    <th>Max Score</th>
                    <th>My Score</th>
                    <th>Approx. Contribution</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    <tr>
                        <td>{{ row.assessment.name }}</td>
                        <td>{{ row.assessment.get_type_display }}</td>
                        <td>{{ row.assessment.date|default:"-" }}</td>
                        <td>{{ row.assessment.weight_in_course }}</td>
                        <td>{{ row.assessment.max_score }}</td>
                        <td>{{ row.score_value|default:"-" }}</td>
                        <td>
                            {% if row.contribution %}
                                {{ row.contribution|floatformat:2 }} / 100
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="7">
                            <strong>LO / PO mapping:</strong>
                            {% if row.lo_rows %}
                                <ul>
                                    {% for lo_row in row.lo_rows %}
                                        <li>
                                            <strong>{{ lo_row.lo.code }}</strong>
                                            – {{ lo_row.lo.description }}
                                            (LO weight: {{ lo_row.weight_in_assessment }}%)
                                            {% if lo_row.po_rows %}
                                                <br>
                                                <span class="muted">Contributes to:</span>
                                                <ul>
                                                    {% for po_row in lo_row.po_rows %}
                                                        <li>
                                                            {{ po_row.po.code }} – {{ po_row.po.description }}
                                                            ({{ po_row.weight }}%)
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <em class="muted">No LO mapping defined for this assessment yet.</em>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="muted">No assessments defined for this course yet.</p>
    {% endif %}
</section>

<p>
    <a class="button-link" href="{% url 'accounts:student_dashboard' %}">← Back to my courses</a>
</p>
{% endblock %}
